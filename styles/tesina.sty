% tesina.sty
% Stile minimalista per tesine conservatorio
% Gestisce SOLO formattazione, zero logica

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tesina}[2025/01/15 Tesina template]

% ============================================
% GEOMETRY - Margini esatti conservatorio
% ============================================
\RequirePackage[
  a4paper, 
  top=2.5cm, 
  bottom=2.5cm, 
  left=2cm, 
  right=2cm
]{geometry}

\RequirePackage{styles/wrapfig}
\RequirePackage{longtable}

% ============================================
% FONT
% ============================================
\RequirePackage{fontspec}
\RequirePackage{etoolbox} % per i condizionali

\input{styles/config_fonts.tex}

\newcommand{\defaultfont}{Liberation Sans}

% scelgo il font in base alla variabile
\ifdefstring{\chosenfont}{arial}{
    % Se è arial
    \setmainfont{Arial}
    \setsansfont{Arial}
    \setmonofont{Arial}
}{
    % Altrimenti
    \setmainfont{\defaultfont}
    \setsansfont{\defaultfont}
    \setmonofont{Liberation Mono}
}

\renewcommand{\familydefault}{\sfdefault}



% ============================================
% INTERLINEA - Singola
% ============================================
\RequirePackage{setspace}
\setstretch{1.0}

% ============================================
% PARAGRAFI - Niente rientro, spazi tra accapi
% ============================================
\setlength{\parindent}{0pt}
\setlength{\parskip}{1\baselineskip}

% ============================================
% TITOLI SEZIONI - Esattamente come conservatorio
% ============================================
\usepackage{styles/titlesec}

% SEZIONI: 12pt bold UPPERCASE
\titleformat{\section}
  {\bfseries\fontsize{12}{14}\selectfont}
  {\thesection}
  {1em}
  {\MakeUppercase} 

% SOTTOSEZIONI: 12pt italic
\titleformat{\subsection}
  {\itshape\bfseries\fontsize{12}{14}\selectfont}
  {\thesubsection}
  {1em}
  {}

% SOTTOSOTTOSEZIONI: 12pt italic
\titleformat{\subsubsection}
  {\itshape\fontsize{12}{14}\selectfont}
  {\thesubsubsection}
  {1em}
  {}

% Spaziatura titoli
\titlespacing{\section}{0pt}{12pt plus 3pt minus 3pt}{6pt plus 2pt minus 2pt}
\titlespacing{\subsection}{0pt}{10pt plus 2pt minus 2pt}{5pt plus 1pt minus 1pt}
\titlespacing{\subsubsection}{0pt}{8pt plus 1pt minus 1pt}{4pt plus 1pt minus 1pt}

% ============================================
% BLOCCHI CODICE - LISTINGS
% ============================================
\RequirePackage{xcolor}  % Necessario per i colori
\RequirePackage{listings}

% Comando per inline code (usato da pandoc)
\newcommand{\passthrough}[1]{#1}

% CONFIGURAZIONE GLOBALE CODICE
\lstset{
  % FONT SIZE 10PT (più piccolo del testo normale 12pt)
  basicstyle=\footnotesize\ttfamily,
  
  % WRAPPING AUTOMATICO - manda a capo righe lunghe
  breaklines=true,                      % Attiva wrapping
  breakatwhitespace=false,              % Può spezzare anche dentro parole
  postbreak=\mbox{\textcolor{gray}{\ensuremath{\hookrightarrow}}\space},  % Simbolo freccia per continuazione
  
  % MARGINI - Rientrato rispetto al testo normale
  xleftmargin=1.5cm,                    % Rientro sinistro 1.5cm
  xrightmargin=0.5cm,                   % Margine destro 0.5cm
  
  % BORDO - Linea verticale a sinistra
  frame=l,                              % Solo bordo sinistro
  framerule=2pt,                        % Spessore 2pt
  rulecolor=\color{gray!40},            % Grigio chiaro
  framesep=8pt,                         % Padding tra bordo e codice
  
  % ASPETTO VISIVO
  backgroundcolor=\color{gray!5},       % Sfondo grigio chiarissimo
  showspaces=false,                     % Non mostra spazi
  showstringspaces=false,               % Non mostra spazi in stringhe
  showtabs=false,                       % Non evidenzia tab
  tabsize=2,                            % Tab = 2 spazi
  keepspaces=true,                      % Mantiene spaziature multiple
  columns=flexible                      % Adatta larghezza caratteri
  
  % NUMERI DI RIGA (commentati - rimuovi % per attivarli)
  % numbers=left,                       % Numeri a sinistra
  % numberstyle=\tiny\color{gray},      % Stile numeri
  % numbersep=10pt,                     % Distanza dal codice
  % stepnumber=1,                       % Numera ogni riga
}

% ============================================
% NOTE A PIÈ - Corpo 10 (conservatorio)
% ============================================
\renewcommand{\footnotesize}{\fontsize{10}{12}\selectfont}

% ============================================
% HEADER/FOOTER - Solo numero pagina a centro
% ============================================
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% ============================================
% FIGURE - Didascalie piccole
% ============================================
\RequirePackage{caption}
\captionsetup{font=small, skip=10pt}

% ============================================
% BLOCK QUOTES - Rientro e font ridotto
% ============================================
\RequirePackage{etoolbox} % Pacchetto per modificare ambienti esistenti
\AtBeginEnvironment{quote}{%
  \fontsize{11}{13}\selectfont % Imposta la dimensione del font a 11pt
  \singlespacing % Assicura che l'interlinea sia singola rispetto al nuovo font
}

% ============================================
% FINITO - SEMPLICE, no logica
% ============================================

\endinput
